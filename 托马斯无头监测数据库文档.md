### 代购业务统计成功率和时长的数据库，无密码，无机制

* 建立数据库statistics，一个集合表monitor,无索引。Monitor表用来监控每次请求成功率和耗时的。

| 字段       | 类型         | 约束 | 说明                                  |
| ---------- | ------------ | ---- | ------------------------------------- |
| Status     | String       | 无   | 监控类型，下单order/审核audit/支付pay |
| key        | String / int |      | 接口传来的订单号                      |
| Start_time | Int          |      | 接口进来的时间戳                      |
| Run_time   | Float        |      | 此订单此次运行时间                    |
| ip         | String       |      | 运行在哪台机器                        |
| proxy      | String       |      | 使用的哪个代理服务器                  |
| Real_msg   | String       |      | 真正的失败原因                        |
| Return_msg | string       |      | 修饰返回接口的失败原因                |

### 监测登录数据库，存储的是参数，无密码，有机制

* 建立数据库package，三个集合表time,parameter,content,建立俩个索引。  
Time表用来存储抓取的俩个时间范围，一个最新一次抓取时间，一个上一次抓取时间

| 字段     | 类型   | 约束 | 说明               |
| -------- | ------ | ---- | ------------------ |
| type     | string | 无   | 定义类型来查找时间 |
| New_time | int    | 无   | 最新时间           |
| Old_time | int    | 无   | 上一次时间         |

* Parameter表用来存储抓取的参数

| 字段            | 类型   | 约束                 | 说明                 |
| --------------- | ------ | ----------------- | -------------------- |
| package         | String |                    | 抓取包名称             |
| package_type    | String |                           | 抓取包的类型，xhr/img  |
| package_method  | String |                           | 抓取包的方法get/post   |
| package_url     | String | 联合索引               | 链接地址               |
| package_args    | list   |                           | 地址后面的参数         |
| package_headers | list   |                           | 地址请求头参数         |
| package_cookies | list   |                           | 地址请求cookie参数     |
| package_sets    | list   |                           | 地址响应回传cookie参数 |
| scrape_time     | int    | 联合索引                  | 抓取时间戳             |

* Content表用来存储抓取js的内容

| 字段         | 类型   | 约束                      | 说明         |
| ------------ | ------ | ------------------------- | ------------ |
| Package_url  | string | 联合scrape_time约束unique | 链接地址     |
| Package_text | String |                           | 地址响应内容 |
| scrape_time  | int    | 联合索引                  | 抓取时间戳   |

### 表建立索引语句

db.parameter.createIndex({package_url: 1, scrape_time: 1}, {unique: true});

 